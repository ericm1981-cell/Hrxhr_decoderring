<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HPR Forecast + Recovery</title>
<style>
  :root{
    --bg:#f6f8fc; --card:#ffffff; --text:#0f172a; --muted:#64748b; --line:#e5e7eb;
    --blue:#0b3aa8; --blue2:#1e4fbf; --orange:#f97316;
    --good:#16a34a; --bad:#dc2626; --warn:#d97706;
    --shadow:0 10px 26px rgba(2,6,23,.08); --radius:14px;
    --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
  .topbar{
    display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
    padding:14px 16px;background:linear-gradient(90deg,var(--blue),var(--blue2));
    color:#fff;border-bottom:3px solid var(--orange)
  }
  .topbar h1{margin:0;font-size:16px;font-weight:900;letter-spacing:.2px}
  .topbar .sub{margin-top:6px;font-size:12px;opacity:.92;line-height:1.35;max-width:900px}
  .pill{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.16);
    border:1px solid rgba(255,255,255,.22);border-radius:999px;padding:6px 10px;font-size:12px}
  .mono{font-family:var(--mono)}
  .wrap{max-width:1200px;margin:0 auto;padding:16px}
  .grid{display:grid;grid-template-columns:1fr;gap:14px}
  @media(min-width:1100px){.grid{grid-template-columns:1.05fr .95fr}}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px}
  .card h2{margin:0 0 10px 0;font-size:13px;letter-spacing:.25px;text-transform:uppercase;color:var(--muted)}
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px;font-weight:900}
  input,select,textarea{width:100%;border:1px solid var(--line);border-radius:12px;padding:10px;font-size:14px;outline:none;background:#fff;color:var(--text)}
  input::placeholder{color:#94a3b8}
  textarea{min-height:120px;font-family:var(--mono);font-size:12px;resize:vertical}
  .row{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:820px){
    .row.cols2{grid-template-columns:1fr 1fr}
    .row.cols3{grid-template-columns:1fr 1fr 1fr}
    .row.cols4{grid-template-columns:1fr 1fr 1fr 1fr}
  }
  .actions{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-top:10px}
  .btn{border:1px solid var(--line);background:#fff;color:var(--text);border-radius:10px;padding:10px 12px;font-weight:900;font-size:13px;cursor:pointer}
  .btn.primary{background:var(--blue2);color:#fff;border-color:transparent}
  .btn.primary:hover{background:var(--blue)}
  .btn:hover{border-color:#cbd5e1}
  .btn.ghost{background:transparent;border-color:rgba(255,255,255,.35);color:#fff}
  .btn.ghost:hover{background:rgba(255,255,255,.10)}
  .btn.danger{color:var(--bad);border-color:rgba(220,38,38,.25)}
  .btn.danger:hover{border-color:rgba(220,38,38,.45)}
  .status{
    margin-top:12px;border:1px solid var(--line);border-radius:14px;padding:14px;
    background:linear-gradient(180deg,#ffffff,#fbfdff);
    display:flex;justify-content:space-between;gap:12px;align-items:flex-start
  }
  .status .title{font-size:18px;font-weight:1000;margin:0}
  .status .detail{margin-top:6px;color:var(--muted);font-size:12px;line-height:1.35}
  .status.good{border-color:rgba(22,163,74,.35)}
  .status.bad{border-color:rgba(220,38,38,.35)}
  .status.warn{border-color:rgba(217,119,6,.35)}
  .status.good .title{color:var(--good)}
  .status.bad .title{color:var(--bad)}
  .status.warn .title{color:var(--warn)}
  .kpis{margin-top:12px;display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:820px){.kpis{grid-template-columns:1fr 1fr}}
  .kpi{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff}
  .kpi .k{font-size:12px;color:var(--muted);font-weight:900}
  .kpi .v{margin-top:6px;font-size:20px;font-weight:1000;letter-spacing:.2px}
  table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--line);border-radius:12px;overflow:hidden;font-size:12px}
  th,td{padding:9px 10px;border-bottom:1px solid var(--line);text-align:left;vertical-align:top}
  th{background:#f8fafc;color:var(--muted);font-weight:1000;text-transform:uppercase;letter-spacing:.2px;font-size:11px}
  tr:last-child td{border-bottom:none}
  .divider{height:1px;background:var(--line);margin:12px 0}
  .tiny{font-size:11px;color:var(--muted);line-height:1.35}
  .badge{display:inline-flex;align-items:center;gap:6px;border-radius:999px;padding:4px 8px;font-size:11px;font-weight:1000;border:1px solid var(--line);background:#fff}
  .badge.good{border-color:rgba(22,163,74,.35);color:var(--good)}
  .badge.bad{border-color:rgba(220,38,38,.35);color:var(--bad)}
</style>
</head>
<body>
  <div class="topbar">
    <div>
      <h1>HPR Forecast + Recovery</h1>
      <div class="sub">
        Answer: <b>“Where do you expect to be?”</b> using <b>current time</b>, <b>shift</b>, and <b>breaks/lunch</b> (excluded).
        Forecasts end-of-shift units for <b>0 / +1 / +2 hours OT</b> and generates a <b>recovery plan</b>.
      </div>
    </div>
    <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px;white-space:nowrap">
      <div class="pill"><span>Now</span><span class="mono" id="nowClock">--:--</span></div>
      <button class="btn ghost" id="clockBtn" type="button">Clock: ON</button>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <section class="card">
        <h2>Inputs</h2>

        <div class="row cols4">
          <div>
            <label>Line</label>
            <select id="lineSel"></select>
            <div class="tiny">Day shift: 06:00–14:30. Pictures 2nd: 15:30–24:00. Pictures OT: 24:00–02:00.</div>
          </div>
          <div>
            <label>Today's Schedule (units)</label>
            <input id="schedUnits" type="number" min="0" inputmode="numeric" />
          </div>
          <div>
            <label>Units Completed So Far (today)</label>
            <input id="doneUnits" type="number" min="0" inputmode="numeric" placeholder="e.g., 140" />
          </div>
          <div>
            <label>Current HPR % (today)</label>
            <input id="hprPct" type="number" min="0" max="200" step="0.1" inputmode="decimal" placeholder="e.g., 92" />
          </div>
        </div>

        <div class="row cols3" style="margin-top:10px">
          <div>
            <label>Shift</label>
            <select id="shiftSel">
              <option value="DAY">Day Shift (06:00–14:30)</option>
              <option value="PIC2">Pictures 2nd Shift (15:30–24:00)</option>
            </select>
          </div>
          <div>
            <label>OT Scenario</label>
            <select id="otSel">
              <option value="0">0 hrs OT</option>
              <option value="60">+1 hr OT</option>
              <option value="120">+2 hrs OT</option>
            </select>
          </div>
          <div>
            <label>Extra 10-min Break on 10-hr day</label>
            <select id="extraBreakSel">
              <option value="on">ON (subtract 10 min when +2 hrs OT)</option>
              <option value="off">OFF</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="calcBtn" type="button">Forecast</button>
          <button class="btn" id="saveBtn" type="button">Save Settings</button>
          <button class="btn danger" id="resetBtn" type="button">Reset</button>
        </div>

        <div class="status" id="statusBox">
          <div>
            <div class="title" id="statusTitle">Waiting for input</div>
            <div class="detail" id="statusDetail">Enter schedule + done units, then Forecast.</div>
          </div>
          <div class="pill"><span>Avail Min Remaining</span><span class="mono" id="availMinPill">—</span></div>
        </div>

        <div class="kpis">
          <div class="kpi">
            <div class="k">Takt (sec/unit)</div>
            <div class="v" id="taktSec">—</div>
          </div>
          <div class="kpi">
            <div class="k">Required Avg Rate (units/hr) from now</div>
            <div class="v" id="reqRate">—</div>
          </div>
          <div class="kpi">
            <div class="k">Forecast End Units (selected OT)</div>
            <div class="v" id="fcstUnits">—</div>
          </div>
          <div class="kpi">
            <div class="k">Forecast vs Schedule (selected OT)</div>
            <div class="v" id="fcstDelta">—</div>
          </div>
        </div>

        <div class="divider"></div>

        <h2>OT Comparison</h2>
        <table>
          <thead>
            <tr>
              <th>Scenario</th>
              <th>Avail Min Remaining</th>
              <th>Forecast End Units</th>
              <th>Delta vs Schedule</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="otBody"></tbody>
        </table>
      </section>

      <aside class="card">
        <h2>Break/Lunch Windows</h2>
        <div class="tiny">
          These are subtracted from <b>available time remaining</b>. Format: <span class="mono">HH:MM-HH:MM</span> (one per line).
          Use 24-hour time. Midnight = <span class="mono">24:00</span>.
        </div>

        <div style="margin-top:10px">
          <label>Day Shift Breaks (06:00–14:30)</label>
          <textarea id="breaksDay"></textarea>
        </div>
        <div style="margin-top:10px">
          <label>Pictures 2nd Shift Breaks (15:30–24:00)</label>
          <textarea id="breaksPic"></textarea>
        </div>

        <div class="divider"></div>
        <h2>Recovery Plan</h2>
        <div id="recoveryBox" class="tiny">Run Forecast to generate a recovery plan.</div>

        <div class="divider"></div>
        <div class="tiny">
          If you want the breaks list to be selectable from your HPR Reasons codes, we can add presets (Break, Lunch, Meeting, Training, etc.).
        </div>
      </aside>
    </div>
  </div>

<script>
const LINE_DEFAULT_SCHEDULE = {
  "LINE1": 260,
  "LINE2": 385,
  "LINE3": 195,
  "CASEMENT": 108,
  "PX/SL": 115
};

const LS = {
  line: "hprfc_line_v2",
  shift: "hprfc_shift_v2",
  breaksDay: "hprfc_breaks_day_v2",
  breaksPic: "hprfc_breaks_pic_v2",
  extraBreak: "hprfc_extra_break_v2",
  schedByLine: "hprfc_sched_by_line_v2"
};

const $ = (id)=>document.getElementById(id);
let clockOn = true, timer=null;

function pad(n){ return String(n).padStart(2,"0"); }
function nowHHMM(){ const d=new Date(); return pad(d.getHours())+":"+pad(d.getMinutes()); }
function parseHHMM(hhmm){ const [h,m]=hhmm.split(":").map(Number); return h*60+m; }

function setStatus(kind,title,detail){
  const box=$("statusBox");
  box.classList.remove("good","bad","warn");
  if(kind) box.classList.add(kind);
  $("statusTitle").textContent=title;
  $("statusDetail").textContent=detail;
}

function startClock(){
  stopClock();
  const tick=()=>{ $("nowClock").textContent = nowHHMM(); };
  tick(); timer=setInterval(tick,1000);
}
function stopClock(){ if(timer) clearInterval(timer); timer=null; }

function buildLineDropdown(){
  const sel=$("lineSel");
  sel.innerHTML="";
  Object.keys(LINE_DEFAULT_SCHEDULE).forEach(l=>{
    const opt=document.createElement("option");
    opt.value=l; opt.textContent=l;
    sel.appendChild(opt);
  });
  const saved=localStorage.getItem(LS.line);
  if(saved && LINE_DEFAULT_SCHEDULE[saved]) sel.value=saved;
}

function defaultShiftForLine(line){
  // all lines day by default; PX/SL can be pictures second if you want
  return (line==="PX/SL") ? "PIC2" : "DAY";
}

function loadScheduleOverrides(){
  try{
    const raw=localStorage.getItem(LS.schedByLine);
    return raw ? JSON.parse(raw) : {};
  }catch{ return {}; }
}
function saveScheduleOverride(line, units){
  const o=loadScheduleOverrides();
  o[line]=units;
  localStorage.setItem(LS.schedByLine, JSON.stringify(o));
}

function setScheduleDefault(){
  const line=$("lineSel").value;
  const overrides=loadScheduleOverrides();
  const v = (overrides[line]!==undefined) ? overrides[line] : (LINE_DEFAULT_SCHEDULE[line] ?? 0);
  $("schedUnits").value = String(v);
  $("shiftSel").value = defaultShiftForLine(line);
}

function parseBreakLines(text){
  const lines=(text||"").split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  const out=[];
  for(const ln of lines){
    const parts=ln.split("-");
    if(parts.length!==2) continue;
    const a=parts[0].trim(), b=parts[1].trim();
    if(!/^\d{2}:\d{2}$/.test(a) || !/^\d{2}:\d{2}$/.test(b)) continue;
    out.push([a,b]);
  }
  return out;
}

function loadBreakDefaults(){
  const daySaved=localStorage.getItem(LS.breaksDay);
  const picSaved=localStorage.getItem(LS.breaksPic);

  // Replace with your real HPR Reasons break/lunch windows as needed
  const dayDefault = ["09:00-09:10","11:30-12:00","13:30-13:40"].join("\n");
  const picDefault = ["18:00-18:10","20:30-21:00","22:30-22:40"].join("\n");

  $("breaksDay").value = daySaved ? daySaved : dayDefault;
  $("breaksPic").value = picSaved ? picSaved : picDefault;

  const eb=localStorage.getItem(LS.extraBreak);
  if(eb) $("extraBreakSel").value=eb;

  const sh=localStorage.getItem(LS.shift);
  if(sh) $("shiftSel").value=sh;
}

function shiftTimes(shiftCode, otMinutes){
  if(shiftCode==="DAY"){
    return {startMin: parseHHMM("06:00"), endMin: parseHHMM("14:30") + otMinutes};
  }
  // PIC2: 15:30–24:00, OT: 24:00–02:00
  return {startMin: parseHHMM("15:30"), endMin: parseHHMM("24:00") + otMinutes};
}

function getBreakSet(shiftCode){
  return (shiftCode==="DAY") ? parseBreakLines($("breaksDay").value) : parseBreakLines($("breaksPic").value);
}

function overlapMinutes(aStart,aEnd,bStart,bEnd){
  const s=Math.max(aStart,bStart);
  const e=Math.min(aEnd,bEnd);
  return Math.max(0,e-s);
}

function minutesAvailableRemaining(shiftCode, otMinutes){
  const now = parseHHMM(nowHHMM());
  const {startMin,endMin} = shiftTimes(shiftCode, otMinutes);

  let nowT=now;
  let startT=startMin;
  let endT=endMin;

  // If shift extends past midnight (pictures OT), map times after midnight onto +1440 timeline
  if(endT > 1440 && nowT < startT) nowT += 1440;

  const remGross=Math.max(0,endT-nowT);

  const breaks=getBreakSet(shiftCode).map(([a,b])=>{
    let s=parseHHMM(a), e=parseHHMM(b);
    if(endT>1440){
      if(s < startT) s += 1440;
      if(e <= s) e += 1440;
    }
    return {s,e};
  });

  let sub=0;
  for(const br of breaks){
    sub += overlapMinutes(nowT,endT,br.s,br.e);
  }

  if(otMinutes>=120 && $("extraBreakSel").value==="on"){
    sub += 10;
  }
  return Math.max(0, remGross - sub);
}

function minutesAvailableElapsed(shiftCode){
  const now=parseHHMM(nowHHMM());
  const {startMin,endMin} = shiftTimes(shiftCode, 0);

  let nowT=now;
  let startT=startMin;
  let endT=endMin;

  // pictures: if now is after midnight, map to +1440
  if(endT===1440 && nowT < startT) nowT += 1440;

  const elapsedGross = Math.max(0, Math.min(nowT, endT) - startT);

  const breaks=getBreakSet(shiftCode).map(([a,b])=>{
    let s=parseHHMM(a), e=parseHHMM(b);
    if(endT===1440 && nowT>1440){
      if(s < startT) s += 1440;
      if(e <= s) e += 1440;
    }
    return {s,e};
  });

  let sub=0;
  for(const br of breaks){
    sub += overlapMinutes(startT, Math.min(nowT,endT), br.s, br.e);
  }
  return Math.max(0, elapsedGross - sub);
}

function forecastUnits(line, schedUnits, doneUnits, hprPct, shiftCode, otMinutes){
  const availRem = minutesAvailableRemaining(shiftCode, otMinutes);
  const elapsedAvail = minutesAvailableElapsed(shiftCode);
  const remAvail0 = minutesAvailableRemaining(shiftCode, 0);
  const plannedAvail0 = Math.max(1, elapsedAvail + remAvail0);

  const unitsPerMin_100 = schedUnits / plannedAvail0;

  const hpr = Number.isFinite(hprPct) ? (hprPct/100) : null;
  const addHpr = (hpr!==null) ? (unitsPerMin_100 * hpr * availRem) : null;

  const paceUPerMin = (elapsedAvail > 0) ? (doneUnits / elapsedAvail) : null;
  const addPace = (paceUPerMin!==null) ? (paceUPerMin * availRem) : null;

  let add=0, methodNote="Insufficient data";
  if(addHpr!==null && addPace!==null){
    add = 0.7*addHpr + 0.3*addPace;
    methodNote = "Blend (70% HPR / 30% pace)";
  }else if(addHpr!==null){
    add = addHpr; methodNote="HPR-based";
  }else if(addPace!==null){
    add = addPace; methodNote="Pace-based";
  }

  const endForecast = doneUnits + add;
  return {availRem, plannedAvail0, unitsPerMin_100, endForecast, methodNote};
}

function taktSeconds(plannedAvail0, schedUnits){
  return (plannedAvail0 / Math.max(1,schedUnits)) * 60;
}

function buildRecoveryPlan(delta, availRem, remainingUnits, unitsPerMin_100, line){
  if(delta >= 0){
    return `<span class="badge good">GREEN</span> <b>Protect the day.</b><br/>
      • Maintain constraint protection (no starving / no blocking).<br/>
      • Hold hourly discipline: <span class="mono">${(unitsPerMin_100*60).toFixed(1)}</span> units/hr @ 100%.<br/>
      • If next hour dips RED, switch to recovery mode immediately (runner, helper, no-stop window).`;
  }
  const short=Math.abs(delta);
  const hrsLeft=availRem/60;
  const addPerHr=(hrsLeft>0)?(short/hrsLeft):short;

  let focus="Remove micro-stops + protect constraint.";
  if(line==="LINE1") focus="Stabilize after redesign: staffing coverage, training blocks, stop/start discipline.";
  if(line==="LINE2") focus="Constraint-driven: stop post-welder blocking/quality holds; fast response to jams.";
  if(line==="LINE3") focus="Standard work + materials staging; prevent stacking small losses.";
  if(line==="CASEMENT") focus="Quality holds/changeovers dominate—tight containment + quick resets.";
  if(line==="PX/SL") focus="Balance work + eliminate waiting; confirm upstream readiness.";

  return `<span class="badge bad">RED</span> <b>Recovery required.</b><br/>
    • Projected short: <b>${short.toFixed(1)}</b> units.<br/>
    • Need to win back: <b>${addPerHr.toFixed(1)}</b> extra units/hr for rest of shift.<br/>
    • Set a 60-minute “no-stop window” with a dedicated responder (TL/utility).<br/>
    • Pick 1 loss category to kill now (materials, minor jams, quality holds).<br/>
    • <b>Focus:</b> ${focus}<br/>
    • If recovery not achieved next hour → escalate (+help or move to +1 hr OT with conditions).`;
}

function paintOTTable(rows){
  const body=$("otBody"); body.innerHTML="";
  for(const r of rows){
    const tr=document.createElement("tr");
    const status = (r.delta>=0) ? '<span class="badge good">GREEN</span>' : '<span class="badge bad">RED</span>';
    tr.innerHTML = `
      <td><b>${r.label}</b></td>
      <td class="mono">${r.availRem.toFixed(0)}</td>
      <td class="mono">${r.endForecast.toFixed(1)}</td>
      <td class="mono">${(r.delta>=0?"+":"") + r.delta.toFixed(1)}</td>
      <td>${status}</td>
    `;
    body.appendChild(tr);
  }
}

function calc(){
  const line=$("lineSel").value;
  const shiftCode=$("shiftSel").value;
  const sched=Number($("schedUnits").value);
  const done=Number($("doneUnits").value);
  const hprRaw=$("hprPct").value.trim();
  const hprPct=(hprRaw==="") ? NaN : Number(hprRaw);
  const otSel=Number($("otSel").value);

  if(!Number.isFinite(sched) || sched<=0){ setStatus("warn","Enter schedule units","Schedule units are required."); return; }
  if(!Number.isFinite(done) || done<0){ setStatus("warn","Enter units completed","Units completed so far is required."); return; }
  if(hprRaw!=="" && (!Number.isFinite(hprPct) || hprPct<0 || hprPct>200)){ setStatus("warn","Invalid HPR%","HPR% must be 0–200 (or blank)."); return; }

  const elapsedAvail=minutesAvailableElapsed(shiftCode);
  const remAvail0=minutesAvailableRemaining(shiftCode,0);
  const plannedAvail0=Math.max(1, elapsedAvail + remAvail0);

  const takt=taktSeconds(plannedAvail0,sched);
  $("taktSec").textContent = takt.toFixed(0);

  const remainingUnits=Math.max(0, sched-done);
  const availRemSel=minutesAvailableRemaining(shiftCode, otSel);
  $("availMinPill").textContent = availRemSel.toFixed(0);

  const reqRate = (availRemSel>0) ? (remainingUnits/(availRemSel/60)) : (remainingUnits>0?Infinity:0);
  $("reqRate").textContent = (reqRate===Infinity) ? "—" : reqRate.toFixed(1);

  const scenarios=[{label:"0 OT",ot:0},{label:"+1 hr OT",ot:60},{label:"+2 hrs OT",ot:120}];
  const rows=[];
  for(const sc of scenarios){
    const f=forecastUnits(line,sched,done,hprPct,shiftCode,sc.ot);
    rows.push({...f,label:sc.label,ot:sc.ot,delta:(f.endForecast - sched)});
  }
  paintOTTable(rows);

  const selRow=rows.find(r=>r.ot===otSel) || rows[0];
  $("fcstUnits").textContent = selRow.endForecast.toFixed(1);
  $("fcstDelta").textContent = (selRow.delta>=0?"+":"") + selRow.delta.toFixed(1);

  if(selRow.delta>=0){
    setStatus("good","ON TRACK (GREEN)",`${line}: projected to meet schedule for selected OT. Method: ${selRow.methodNote}.`);
  }else{
    setStatus("bad","OFF TRACK (RED)",`${line}: projected short for selected OT. Method: ${selRow.methodNote}.`);
  }

  $("recoveryBox").innerHTML = buildRecoveryPlan(selRow.delta, selRow.availRem, remainingUnits, selRow.unitsPerMin_100, line);

  // save schedule override for convenience (keeps daily schedule after refresh)
  saveScheduleOverride(line, sched);
}

function saveSettings(){
  localStorage.setItem(LS.line, $("lineSel").value);
  localStorage.setItem(LS.shift, $("shiftSel").value);
  localStorage.setItem(LS.breaksDay, $("breaksDay").value);
  localStorage.setItem(LS.breaksPic, $("breaksPic").value);
  localStorage.setItem(LS.extraBreak, $("extraBreakSel").value);
  setStatus("good","Saved","Settings saved on this device.");
}

function resetAll(){
  Object.values(LS).forEach(k=>localStorage.removeItem(k));
  buildLineDropdown();
  setScheduleDefault();
  $("doneUnits").value="";
  $("hprPct").value="";
  $("shiftSel").value="DAY";
  $("otSel").value="0";
  $("extraBreakSel").value="on";
  loadBreakDefaults();
  $("otBody").innerHTML="";
  ["taktSec","reqRate","fcstUnits","fcstDelta","availMinPill"].forEach(id=>$(id).textContent="—");
  $("recoveryBox").textContent="Run Forecast to generate a recovery plan.";
  setStatus(null,"Waiting for input","Enter schedule + done units, then Forecast.");
}

$("calcBtn").addEventListener("click", calc);
$("saveBtn").addEventListener("click", saveSettings);
$("resetBtn").addEventListener("click", resetAll);

$("clockBtn").addEventListener("click", ()=>{
  clockOn=!clockOn;
  $("clockBtn").textContent="Clock: "+(clockOn?"ON":"OFF");
  if(clockOn) startClock(); else stopClock();
});

$("lineSel").addEventListener("change", ()=>{ setScheduleDefault(); });

function loadBreakDefaults(){
  const daySaved=localStorage.getItem(LS.breaksDay);
  const picSaved=localStorage.getItem(LS.breaksPic);

  const dayDefault=["09:00-09:10","11:30-12:00","13:30-13:40"].join("\n");
  const picDefault=["18:00-18:10","20:30-21:00","22:30-22:40"].join("\n");

  $("breaksDay").value = daySaved ? daySaved : dayDefault;
  $("breaksPic").value = picSaved ? picSaved : picDefault;

  const eb=localStorage.getItem(LS.extraBreak);
  if(eb) $("extraBreakSel").value=eb;

  const sh=localStorage.getItem(LS.shift);
  if(sh) $("shiftSel").value=sh;
}

function init(){
  buildLineDropdown();
  loadBreakDefaults();

  const savedLine=localStorage.getItem(LS.line);
  if(savedLine && LINE_DEFAULT_SCHEDULE[savedLine]) $("lineSel").value=savedLine;

  setScheduleDefault();

  startClock();
  setStatus(null,"Waiting for input","Enter schedule + done units, then Forecast.");
}

init();
</script>
</body>
</html>
